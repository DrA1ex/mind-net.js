!function(){"use strict";function t(t,e){const n=Math.max(t.length,e.length),o=new Array(n);for(let r=0;r<n;r++)o[r]=[t[r],e[r]];return o}function e(t,e){return Array.from(function*(t,e){let n=0;for(const o of t)yield e(o,n),n+=1}(function*(t,e){for(let n=0;n<e;++n)yield n}(0,e),t))}function n(t,e,n){const o=Math.min(t.length,e.length),r=new Array(o);for(let s=0;s<o;++s)r[s]=n(t[s],e[s]);return r}function o(t,e){const n=t.length,o=new Array(n);for(let r=0;r<n;++r)o[r]=e(t[r]);return o}function r(t,e){!function(t,e,n){const o=Math.min(t.length,e.length);for(let r=0;r<o;++r)t[r]=t[r]+e[r]}(t,e)}function s(t,e){return o(t,t=>t*e)}function i(t,e){const n=Math.min(t.length,e.length);let o=0,r=0;for(let s=0;s<n;++s){const n=t[s]*e[s]-r,i=o+n;r=i-o-n,o=i}return o}function a(t,n=0,o=1){const r=o-n;return e(()=>n+Math.random()*r,t)}function l(t,e){const n=new Array(t[0].length),o=Math.min(t.length,e.length);for(let r=0;r<n.length;++r){let s=0,i=0;for(let n=0;n<o;n++){const o=t[n][r]*e[n]-i,a=s+o;i=a-s-o,s=a}n[r]=s}return n}class c{constructor(t,n){var o;this.neuronCnt=t,this.prevLayer=n;const r=(null===(o=this.prevLayer)||void 0===o?void 0:o.neuronCnt)||0;this.values=function(t,n){return e(()=>0,n)}(0,this.neuronCnt),this.biases=a(this.neuronCnt,-1,1),this.backWeights=r>0?function(t,n,o=0,r=1){return e(t=>a(n,o,r),t)}(this.neuronCnt,r):[]}}class h{constructor(...t){this.layers=new Array(t.length),this.learningRate=.01;for(let e=0;e<t.length;e++)this.layers[e]=new c(t[e],e>0?this.layers[e-1]:void 0)}train(t,e){let i=n(e,this.compute(t),(t,e)=>t-e);for(let a=this.layers.length-2;a>=0;a--){const t=this.layers[a+1],e=this.layers[a],c=s(n(i,o(t.values,t=>t*(1-t)),(t,e)=>t*e),this.learningRate);for(let n=0;n<t.neuronCnt;n++)r(t.backWeights[n],s(e.values,c[n]));r(t.biases,c),null!==e.prevLayer&&(i=l(t.backWeights,i))}}compute(t){let e=this.layers[0];e.values=t;for(let o=1;o<this.layers.length;o++){const t=this.layers[o];for(let o=0;o<t.backWeights.length;o++)t.values[o]=(n=i(t.backWeights[o],e.values)+t.biases[o],1/(1+Math.exp(-n)));e=t}var n;return this.layers[this.layers.length-1].values}}const u=[13,5,5];let f=new h(2,...u,1);f.learningRate=.01;let g=[],y=0,m=0;function p(){const e=5e6-y;if(e<=0||0===g.length)return void setTimeout(p,10.416666666666666);const n=performance.now(),o=g.map(t=>[[t.x,t.y],[t.type]]);let r;for(r=0;r<e;r++){const t=o[Math.floor(Math.random()*o.length)];if(f.train(t[0],t[1]),r%1e4==0&&performance.now()-n>10.416666666666666)break}y+=r,y>=5e6&&(m=0,console.log("*** DATA SET TRAINING FINISHED ***"),function(e,n){console.log("***");for(let o=0;o<n.length;o++){const[r,s]=n[o],i=e.compute(r),a=i.map(t=>t.toFixed(2)),l=s.map(t=>t.toFixed(2)),c=t(s,i).map(([t,e])=>(100-100*Math.abs(t-e)).toFixed(1));console.log(`INPUT ${r} OUTPUT ${a} EXPECTED ${l} (accuracy ${c}%)`)}console.log("***")}(f,o)),function(){const t=performance.now();if(t-m<41.666666666666664)return;const e=Math.ceil(160),n=Math.ceil(90),o=new Uint32Array(e*n);for(let s=0;s<e;s++)for(let t=0;t<n;t++){const n=f.compute([.00625*s,.011111111111111112*t]);o[t*e+s]=4283957454|(255*n[0]&255)<<8}console.log(`*** Computing ${(performance.now()-t).toFixed(2)}ms`);const r={type:"training_data",iteration:y,state:o.buffer,width:e,height:n,t:performance.now()};m=t,postMessage(r,[o.buffer])}()}addEventListener("message",({data:t})=>{var e,n;switch(t.type){case"add_point":g.push(t.point),y=0;break;case"set_points":g=t.points,y=0;break;case"refresh":const o=(null===(e=t.config)||void 0===e?void 0:e.layers)||u,r=(null===(n=t.config)||void 0===n?void 0:n.learningRate)||.01;f=new h(2,...o,1),f.learningRate=r,y=0}}),setTimeout(function t(){try{p()}finally{setTimeout(t,3)}},0)}();