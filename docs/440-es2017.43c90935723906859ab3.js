(self.webpackChunkneural_network=self.webpackChunkneural_network||[]).push([[440],{3430:function(t,e,s){"use strict";s.d(e,{Z:function(){return m}});var i=s(5307);const r={sgd:class{constructor(t=.01){this.lr=t,this.description=`sgd(lr: ${this.lr})`}step(t,e,s,r){const a=i.fe(e,s,(e,s)=>t.activation.moment(e)*s*this.lr);return{weightStep:a,biasStep:a}}},nesterov:class{constructor(t=.01,e=.9){this.cache=new Map,this.lr=t,this.beta=e,this.description=`nesterov(beta: ${this.beta}, lr: ${this.lr})`}step(t,e,s,r){this.cache.has(t)||this.cache.set(t,{tmp1:i.bM(t.size),weights:{moments:i.bM(t.size)}});const a=this.cache.get(t);return i.fe(e,a.weights.moments,(e,s)=>t.activation.moment(e+s),a.tmp1),i.W0(a.tmp1,s),i.ZN(a.weights.moments,a.tmp1,(t,e)=>this.beta*t+(1-this.beta)*e),i.ZN(a.tmp1,a.weights.moments,(t,e)=>e*this.lr),{weightStep:a.tmp1,biasStep:a.tmp1}}},adam:class{constructor(t=.005,e=.9,s=.999,i=1e-8){this.cache=new Map,this.lr=t,this.beta1=e,this.beta2=s,this.eps=i,this.description=`adam(beta1: ${e}, beta2: ${s}, lr: ${this.lr}, eps: ${i.toExponential()})`}step(t,e,s,r){this.cache.has(t)&&0!==r||this.cache.set(t,{moments:i.bM(t.size),velocities:i.bM(t.size),tmp1:i.bM(t.size),tmp2:i.bM(t.size)});const a=this.cache.get(t);return i.fe(e,s,(e,s)=>t.activation.moment(e)*s,a.tmp1),i.ZN(a.moments,a.tmp1,(t,e)=>t*this.beta1+(1-this.beta1)*e),i.ZN(a.velocities,a.tmp1,(t,e)=>t*this.beta2+(1-this.beta2)*e*e),i.ZN(a.tmp1,a.moments,(t,e)=>e/(1-Math.pow(this.beta1,r+1))),i.ZN(a.tmp2,a.velocities,(t,e)=>e/(1-Math.pow(this.beta2,r+1))),i.ZN(a.tmp1,a.tmp2,(t,e)=>t*this.lr/(Math.sqrt(e)+this.eps)),{weightStep:a.tmp1,biasStep:a.tmp1}}},rmsprop:class{constructor(t=.005,e=.9,s=1e-8){this.cache=new Map,this.lr=t,this.beta=e,this.eps=s,this.description=`rmsprop(beta: ${e}, lr: ${this.lr}, eps: ${this.eps})`}step(t,e,s,r){this.cache.has(t)||this.cache.set(t,{velocities:i.bM(t.size),tmp1:i.bM(t.size)});const a=this.cache.get(t);return i.fe(e,s,(e,s)=>s*t.activation.moment(e),a.tmp1),i.ZN(a.velocities,a.tmp1,(t,e)=>this.beta*t+(1-this.beta)*e*e),i.ZN(a.tmp1,a.velocities,(t,e)=>this.lr/Math.sqrt(e+this.eps)*t),{weightStep:a.tmp1,biasStep:a.tmp1}}}};class a{constructor(t=.01){this.alpha=t}value(t){return t>0?t:t*this.alpha}moment(t){return t>0?1:this.alpha}}const n={sigmoid:class{value(t){return 1/(1+Math.exp(-t))}moment(t){const e=this.value(t);return e*(1-e)}},relu:class{constructor(){this.leakyRelu=new a(0)}value(t){return this.leakyRelu.value(t)}moment(t){return this.leakyRelu.moment(t)}},leakyRelu:a,tanh:class{value(t){return Math.tanh(t)}moment(t){return 1-Math.pow(Math.tanh(t),2)}}};function h(t,e,s){return i.hl(()=>function(t=0,e=1){const s=e-t;return t+Math.random()*s}(-s,s),e)}const o={he:function(t,e){return h(0,t,Math.sqrt(2/(e+t)))},he_normal:function(t,e){return h(0,t,Math.sqrt(2/t))},zero:function(t,e){return i.bM(t)},xavier:function(t,e){return h(0,t,Math.sqrt(6/(t+e)))},xavier_normal:function(t,e){return h(0,t,Math.sqrt(6/(t+e)))},uniform:function(t,e){return h(0,t,1)},normal:function(t,e){return h(0,t,1)}},l={Dense:class{constructor(t,e="sigmoid",s="he",i="zero"){if(this.prevSize=0,this.size=t,this.weight_initializer="string"==typeof s?o[s]:s,!this.weight_initializer)throw new Error(`Unknown weight initializer type ${s}`);if(this.bias_initializer="string"==typeof i?o[i]:i,!this.bias_initializer)throw new Error(`Unknown bias initializer type ${i}`);const r="string"==typeof e?n[e]:e;if(!r)throw new Error(`Unknown activation type ${e}`);this.activation="object"==typeof r?r:new r}build(t,e){this.prevSize=e,t>0?(this.weights=i.hl(()=>this.weight_initializer(this.prevSize,this.size),this.size),this.biases=this.bias_initializer(this.size,this.prevSize),this.values=i.bM(this.size)):(this.weights=[],this.biases=[],this.values=[])}step(t){return this.weights.length>0?(i.KM(this.weights,t,this.values),i.BU(this.values,this.biases),this.values):t}}};var c=s(8992);class p{constructor(t="sgd",e=0,s=0){this.l1WeightRegularization=e,this.l2WeightRegularization=s,this._epoch=0,this.compiled=!1,this.cache=new Map,this.optimizer=function(t="sgd"){const e="string"==typeof t?r[t]:t;if(!e)throw new Error(`Unknown optimizer type ${e}`);return"object"==typeof e?e:new e}(t)}get epoch(){return this._epoch}compute(t){var e;if(!this.compiled)throw new Error("Model should be compiled before usage");if(t.length!==this.layers[0].size)throw new Error(`Input matrix has different size. Expected size ${this.layers[0].size}, got ${t.length}`);let s=t;for(let r=1;r<this.layers.length;r++){const t=this.layers[r];s=i.B5(t.step(s),e=>t.activation.value(e),null===(e=this.cache.get(t))||void 0===e?void 0:e.activation)}return s}train(t,e,s=32){if(!this.compiled)throw new Error("Model should be compiled before usage");const i=c.yg(Array.from(c.$R(t,e)));for(const r of c.uK(i,s)){this._clearDelta();for(const[t,e]of r){const s=this._calculateBackpropData(t),i=this._calculateLoss(s.activations[s.activations.length-1],e);this._backprop(s,i)}this._applyDelta(r.length)}this._epoch+=1}_calculateBackpropData(t){var e;if(t.length!==this.layers[0].size)throw new Error(`Input matrix has different size. Expected size ${this.layers[0].size}, got ${t.length}`);const s=new Array(this.layers.length),r=new Array(this.layers.length);s[0]=t;for(let a=1;a<this.layers.length;a++){const t=this.layers[a];r[a]=t.step(s[a-1]),s[a]=i.B5(r[a],e=>t.activation.value(e),null===(e=this.cache.get(t))||void 0===e?void 0:e.activation)}return{activations:s,primes:r}}_calculateLoss(t,e){if(e.length!==t.length)throw new Error(`Output matrix has different size. Expected size ${e.length}, got ${t.length}`);return i.lu(e,t)}_backprop(t,e){const{activations:s,primes:r}=t;let a=e;for(let n=this.layers.length-1;n>0;n--){const t=this.layers[n],{deltaWeights:e,deltaBiases:h}=this.cache.get(t),o=this.optimizer.step(t,r[n],a,this.epoch);for(let r=0;r<t.size;r++)i.ZN(e[r],s[n-1],(t,e)=>t+e*o.weightStep[r]);i.BU(h,o.biasStep),n>1&&(a=i.Kk(t.weights,a))}}_clearDelta(){for(const t of this.layers){const{deltaWeights:e,deltaBiases:s}=this.cache.get(t);s.fill(0),e.forEach(t=>t.fill(0))}}_applyDelta(t){for(let e=1;e<this.layers.length;e++)this._applyLayerDelta(this.layers[e],t)}_applyLayerDelta(t,e){const{deltaWeights:s,deltaBiases:r}=this.cache.get(t);i.ZN(t.biases,r,(t,s)=>t+s/e);for(let a=0;a<t.size;a++)i.ZN(t.weights[a],s[a],(t,s)=>{let i=0;this.l1WeightRegularization>0&&(i=Math.sign(t)*this.l1WeightRegularization);let r=0;return this.l2WeightRegularization>0&&(r=2*t*this.l2WeightRegularization),t-i-r+s/e})}getSnapshot(){return{weights:this.layers.slice(1).map(t=>t.weights.map(t=>i.JG(t))),biases:this.layers.slice(1).map(t=>i.JG(t.biases))}}}"undefined"!=typeof window&&window,"undefined"!=typeof self&&"undefined"!=typeof WorkerGlobalScope&&self instanceof WorkerGlobalScope&&self,"undefined"!=typeof global&&global;class u extends p{constructor(){super(...arguments),this.layers=[],this.trainable=[],this.modelByLayer=new Map,this.models=[]}addModel(t,e=!0){return this.models.push(t),this.trainable.push(e),this}compile(){if(!this.compiled){for(let t=0;t<this.models.length;t++){const e=this.models[t];if(t>0){const s=this.models[t-1],i=e.layers[0].size,r=s.layers[s.layers.length-1].size;if(i!==r)throw new Error(`Models in chain has different in-out sizes: ${r} != ${i}`)}let s;e.compile(),s=t>0?e.layers.slice(1):e.layers;for(const r of s)this.modelByLayer.set(r,[e,this.trainable[t]]),this.cache.set(r,{activation:(0,i.bM)(r.size),deltaBiases:(0,i.bM)(r.size),deltaWeights:(0,i.dW)(r.size,r.prevSize)});this.layers.push(...s)}this.compiled=!0}}_applyDelta(t){for(let e=1;e<this.layers.length;e++){const s=this.layers[e],[,i]=this.modelByLayer.get(s);i&&this._applyLayerDelta(s,t)}}}var m={Activations:n,Initializers:o,Optimizers:r,Layers:l,Models:{Sequential:class extends p{constructor(){super(...arguments),this.layers=[]}addLayer(t){return this.layers.push(t),this}compile(){if(!this.compiled){for(let t=0;t<this.layers.length;t++){const e=this.layers[t],s=t>0?this.layers[t-1].size:0;e.build(t,s),this.cache.set(e,{activation:(0,i.bM)(e.size),deltaBiases:(0,i.bM)(e.size),deltaWeights:(0,i.dW)(e.size,s)})}this.compiled=!0}}},Chain:class extends class{constructor(t,e){this.span=t,this.sourceSpan=e}toString(){return"AST"}}{constructor(t,e,s){super(t,e),this.expressions=s}visit(t,e=null){return t.visitChain(this,e)}},GAN:class{constructor(t,e,s="sgd",i=0,r=0){if(this.generator=t,this.discriminator=e,1!==e.layers[e.layers.length-1].size)throw new Error("Size of discriminator's output should be 1");this.ganChain=new u(s,i,r),this.ganChain.addModel(t).addModel(e,!1).compile()}compute(t){return this.generator.compute(t)}train(t,e=32){for(const s of c.uK(t,e)){const t=i.q9([1],s.length),r=i.q9([0],s.length),a=i.o1(s.length,this.generator.layers[0].size,-1,1);this.discriminator.train(s,t,e);const n=a.map(t=>this.generator.compute(t));this.discriminator.train(n,r,e),this.ganChain.train(a,t,e)}}}}}},3515:function(t,e,s){"use strict";function i(t){const e=function(t){return[Number.parseInt(t.substr(1,2),16),Number.parseInt(t.substr(3,2),16),Number.parseInt(t.substr(5,2),16)]}(t);return 4278190080|e[2]<<16|e[1]<<8|e[0]}function r(t,e,s){const i=t>>16&255,r=t>>8&255,a=255&t;return((e>>16&255)-i)*(s=Math.max(0,Math.min(1,s)))+i<<16|((e>>8&255)-r)*s+r<<8|((255&e)-a)*s+a|4278190080}s.d(e,{h0:function(){return i},a4:function(){return r}})}}]);